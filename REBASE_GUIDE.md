# コミット整理ガイド

## 概要

182個のコミットを意味のある単位にまとめて、クリーンなコミット履歴を作成します。

## 準備

### 1. バックアップブランチを作成

```bash
git branch backup-before-squash-$(date +%Y%m%d-%H%M%S)
```

### 2. 現在の状態を確認

```bash
git log --oneline | head -20
```

## 実行方法

### 方法1: スクリプトを使用（推奨）

```bash
./scripts/prepare_rebase.sh
```

### 方法2: 手動で実行

```bash
FIRST_COMMIT=$(git log --reverse --format="%h" | head -1)
git rebase -i $FIRST_COMMIT
```

## 整理方針

### 主要なグループ

1. **初期コミット** (保持)
   - `e52f926` Initial commit

2. **基本機能実装** (まとめる: 約5-10件)
   - はてなブックマーク、ナビゲーション、データ鮮度情報など

3. **UI改善** (まとめる: 約10-15件)
   - レイアウト調整、UI統一など

4. **キャッシュシステム** (まとめる: 約15-20件)
   - キャッシュ実装、スキーママイグレーションなど

5. **データベース接続** (まとめる: 約10-15件)
   - 接続管理、リトライ、エラーハンドリング

6. **Hatena/Twitch修正** (まとめる: 約5-10件)
   - キャッシュ問題の修正

7. **マネージャー初期化** (まとめる: 約10-15件)
   - 初期化改善、スレッドセーフ

8. **Stock/Crypto追加** (まとめる: 約15-20件)
   - 機能追加、yfinance実装、改善

9. **World News改善** (まとめる: 約2-3件)
   - 最新記事取得、使用量削減

10. **デプロイ・スケジューラー** (まとめる: 約3-5件)
    - 自動実行制御、メール送信制御

11. **プロジェクト整理** (まとめる: 約2-3件)
    - ファイル整理、ドキュメント整理

12. **レート制限実装** (まとめる: 約2件)
    - 統一的なレート制限機能

## rebase操作のコマンド

エディタで表示される各コミットの前に以下のコマンドを指定：

- `pick` (p): コミットをそのまま保持
- `squash` (s): 前のコミットに統合（メッセージを編集）
- `fixup` (f): 前のコミットに統合（メッセージは保持）
- `drop` (d): コミットを削除
- `reword` (r): コミットメッセージを変更

## 例: 整理後のコミット構造

```
e52f926 feat: 初期実装（Flask trends dashboard）
[まとめたコミット1] feat: 基本機能の実装
[まとめたコミット2] feat: UI改善
[まとめたコミット3] feat: キャッシュシステムの実装と改善
[まとめたコミット4] fix: データベース接続管理の改善
[まとめたコミット5] fix: Hatena/Twitchキャッシュ問題の修正
[まとめたコミット6] fix: マネージャー初期化の改善
[まとめたコミット7] feat: Stock/Crypto機能の追加と改善
[まとめたコミット8] fix: World News API改善
[まとめたコミット9] fix: デプロイ・スケジューラー改善
[まとめたコミット10] refactor: プロジェクト整理
[まとめたコミット11] feat: 統一的なレート制限機能の実装
```

## 注意事項

⚠️ **重要**:
- リモートにプッシュする前に実行すること
- バックアップブランチを作成すること
- 整理後は `git push --force` が必要になる可能性がある
- 他の開発者がいる場合は、事前に相談すること

## トラブル時の復元

```bash
# バックアップブランチから復元
git reset --hard backup-before-squash-YYYYMMDD-HHMMSS
```
