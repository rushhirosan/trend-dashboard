# API課金分析：1日2回のデータ更新について

## 概要

現在のスケジューラー設定は**1日1回（朝7時）**ですが、**1日2回**に変更した場合の課金影響を分析します。

## 使用している外部APIと課金体系

### 1. YouTube Data API v3
- **無料クォータ**: 10,000 units/日
- **1回のリクエスト**: 約100-200 units（`search.list`で100 units、`videos.list`で1 unit）
- **1日2回更新**: 約200-400 units/日
- **課金**: **無料枠内** ✅
- **備考**: 無料枠を超えても課金なし（ただし追加クォータの申請が必要）

### 2. Listen Notes API (Podcast)
- **無料プラン**: 300 requests/月
- **1回のリクエスト**: 1 request
- **1日2回更新**: 60 requests/月（30日 × 2回）
- **課金**: **無料枠内** ✅
- **備考**: 月間300リクエスト以内なら無料

### 3. Spotify Web API
- **無料**: 完全無料
- **レート制限**: 10 requests/秒（開発モード）
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

### 4. News API
- **無料プラン**: 100 requests/日
- **1回のリクエスト**: 1 request
- **1日2回更新**: 2 requests/日
- **課金**: **無料枠内** ✅

### 5. World News API
- **無料プラン**: 50 points/日
- **1回のリクエスト**: 約1-2 points（結果数による）
- **1日2回更新**: 約2-4 points/日
- **課金**: **無料枠内** ✅

### 6. Twitch API
- **無料**: 完全無料
- **レート制限**: 800 points/分
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

### 7. 楽天API
- **無料**: アフィリエイトプログラム経由で無料
- **レート制限**: 特に制限なし（適切な使用が前提）
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

### 8. Google Trends (BigQuery)
- **無料**: Google Cloud の無料枠内
- **BigQuery**: 月間1TBのクエリが無料
- **1日2回更新**: 問題なし
- **課金**: **無料枠内** ✅

### 9. Reddit API
- **無料**: 完全無料（認証なしでも利用可能）
- **レート制限**: 自己実装のレート制限あり
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

### 10. Qiita API
- **無料**: 認証なしで1時間60回、認証ありで1時間1000回
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

### 11. Hacker News API
- **無料**: 完全無料
- **レート制限**: なし
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

### 12. Product Hunt API
- **無料**: 完全無料
- **レート制限**: あり（詳細不明）
- **1日2回更新**: 問題なし
- **課金**: **無料** ✅

## インフラコスト

### Fly.io PostgreSQL
- **無料枠**: 3GBの永続ストレージ
- **1日2回更新**: データ量は変わらない（キャッシュの上書き）
- **課金**: **無料枠内** ✅

### Fly.io アプリケーション
- **無料枠**: 3つのshared-cpu-1x 256MB VM
- **1日2回更新**: CPU/メモリ使用量はほぼ同じ
- **課金**: **無料枠内** ✅

## 結論

### ✅ **1日2回のデータ更新でも課金は発生しません**

**理由**:
1. **すべてのAPIが無料枠内**: 1日2回更新でも、すべてのAPIの無料枠内に収まります
2. **インフラコスト**: Fly.ioの無料枠で十分です
3. **データ量**: キャッシュの上書きなので、ストレージ使用量は変わりません

### 注意点

1. **Listen Notes API**: 月間300リクエストの制限があるため、1日2回更新（60回/月）でも余裕があります
2. **YouTube API**: 1日10,000 unitsの制限があり、1日2回更新（約200-400 units）でも十分余裕があります
3. **World News API**: 1日50 pointsの制限があり、1日2回更新（約2-4 points）でも十分余裕があります

### 推奨事項

1日2回更新に変更する場合：
- **推奨時刻**: 朝7時と夜19時（12時間間隔）
- **または**: 朝7時と昼13時（6時間間隔）

スケジューラーの設定変更は `services/scheduler/scheduler_manager.py` で行えます。
